/*!
 *
 * @license Copyright (c) 2014, Matthew Smith. All rights reserved.
 * This work is subject to the terms at http://www.matt.ca/8cHk/terms-of-use.html
 *
 * @author: Matthew Smith, matt@matt.ca
 *
 **/
function mattcaGallery(a,b,c){function d(){bb=window.innerWidth,cb=window.innerHeight,T=document.querySelector("body");var d='<div id="loading"><p>Loading...</p></div><div class="close-icon"></div><div class="right-arrow-icon arrow"></div><div class="left-arrow-icon arrow"></div><div id="gallery" style="position:absolute; left: -'+bb+"px; width: "+3*bb+'px"></div>';T.classList.add("fade-left-arrow"),T.innerHTML=d,U=document.getElementById("gallery"),lb=document.querySelector(".right-arrow-icon"),mb=document.querySelector(".left-arrow-icon"),nb=document.querySelector(".close-icon"),K(),V=a,eb=window.location.search,fb=/photo=(\d*)/,gb=fb.exec(eb),e(),S(),console.log(b),null==b||""==b?(nb.style.display="none",b=""):b=b,console.log(b),c=null==c?3:c}function e(){if(W=new Array,null!=gb&&""!=gb[1]&&gb[1]<V.length&&gb[1]>=0)for(Mb=gb[1]-0,Z=0;Z<V.length;)Z>=Mb-c&&Mb+c>=Z&&(Ob++,image=new Image,image.addEventListener("load",g,!1),image.src=V[Z],W.push(image)),Z++;else for(Z=0;c>Z;)Ob++,W[Z]=new Image,W[Z].addEventListener("load",g,!1),W[Z].src=V[Z],Z++;X=new Array,Ob++,ib=new Image,ib.addEventListener("load",g,!1),ib.src="https://s3-us-west-2.amazonaws.com/mattca-images/gallery-script/ajax-loader.gif",X.push(ib),Ob++,jb=new Image,jb.addEventListener("load",g,!1),jb.src="https://s3-us-west-2.amazonaws.com/mattca-images/gallery-script/arrows.png",X.push(jb),Ob++,kb=new Image,kb.addEventListener("load",g,!1),kb.src="https://s3-us-west-2.amazonaws.com/mattca-images/gallery-script/back-button.png",X.push(kb)}function f(){for(Y=new Array(V.length),Z=0;Z<V.length;){$=0;for(var a=!1;$<W.length;)W[$].src==V[Z]&&(Y[Z]=W[$],a=!0),$++;a||(Y[Z]=new Image,Y[Z].src=V[Z]),Z++}}function g(){Ob--,0==Ob&&h()}function h(){for(f(),Lb=!0,Z=0,_="";Z<V.length;)_+='<div class="container"><div class="photo"></div></div>',Z++;U.innerHTML=_,ab=!1,imgWidth=currentWidth=bb,imgHeight=currentHeight=cb,a=document.querySelectorAll("#gallery .photo"),J(),window.scrollTo(0,0),C(),Q(null!=gb&&""!=gb[1]&&gb[1]<V.length&&gb[1]>=0?parseInt(gb[1]):0),setTimeout(i,510),setTimeout(z,1010),W=null}function i(){document.querySelector("#loading").classList.add("loaded")}function j(a){console.log("touch start"),a.preventDefault(),Pb||(1!=a.touches.length||Sb?1==a.touches.length&&Sb?(console.log("start panning"),Qb=!0,Rb=!1,Sb=!0,qb=a.targetTouches[0].pageX,rb=a.targetTouches[0].pageY):2==a.touches.length&&(console.log("start zooming"),Qb=!1,Rb=!0,Sb=!0,yb=a.targetTouches[0].pageX,zb=a.targetTouches[0].pageY,Ab=a.targetTouches[1].pageX,Bb=a.targetTouches[1].pageY,Cb=Math.sqrt(Math.pow(Ab-yb,2)+Math.pow(Bb-zb,2)),(Vb=1)&&(_b=(yb+Ab)/2,ac=(zb+Bb)/2),B(),H(0)):(Qb=!1,Rb=!1,Sb=!1,ob=a.targetTouches[0].pageX,startY0=a.targetTouches[0].pageY))}function k(a){if(console.log("touch move"),a.preventDefault(),!Pb)if(Qb||Rb||Sb){if(Qb)console.log("panning"),sb=a.touches[0].pageX,tb=a.touches[0].pageY,ub=sb-qb,vb=tb-rb,wb=Tb+ub,xb=Ub+vb,bb>=wb+Ib+(bb-Ib)*Vb?(wb=0,Ib=bb):wb+Ib*(1-Vb)>=0&&(wb=0,Ib=0),cb>=xb+Jb+(cb-Jb)*Vb?(xb=0,Jb=cb):xb+Jb*(1-Vb)>=0&&(xb=0,Jb=0),G(Ib,Jb,wb,xb,Vb);else if(Rb){if(2!=a.touches.length)return;if(T.classList.contains("zoomed")||T.classList.add("zoomed"),Db=a.targetTouches[0].pageX,Eb=a.targetTouches[0].pageY,Fb=a.targetTouches[1].pageX,Gb=a.targetTouches[1].pageY,Hb=Math.sqrt(Math.pow(Fb-Db,2)+Math.pow(Gb-Eb,2)),Vb=Hb/Cb*Wb,1>Vb&&(Vb=1),Vb>5&&(Vb=5),1==Vb&&1==Wb)return;if(5==Vb&&5==Wb)return;Ib=((yb+Ab)/2-Zb)/Wb,Jb=((zb+Bb)/2-$b)/Wb,bc=_b-Ib,cc=ac-Jb,1==Vb&&(bc=0,cc=0),bb>=bc+Ib+(bb-Ib)*Vb?(bc=0,Ib=bb):bc+Ib*(1-Vb)>=0&&(bc=0,Ib=0),cb>=cc+Jb+(cb-Jb)*Vb?(cc=0,Jb=cb):cc+Jb*(1-Vb)>=0&&(cc=0,Jb=0),G(Ib,Jb,bc,cc,Vb)}}else{L();var b=parseFloat(a.targetTouches[0].pageX)-parseFloat(ob);H(b),B()}}function l(b){console.log("touch end"),b.preventDefault(),Pb||(Qb||Rb||Sb?Qb?(Ub=xb,Tb=wb,_b=Ib,ac=Jb,Xb=wb,Yb=xb,Zb=a[Mb].getBoundingClientRect().left,$b=a[Mb].getBoundingClientRect().top):Rb&&(Wb=Vb,_b=Ib,ac=Jb,Xb=bc,Yb=cc,Zb=a[Mb].getBoundingClientRect().left,$b=a[Mb].getBoundingClientRect().top,1==Vb&&(Sb=!1,A(),K()),Ub=bc,Tb=cc):(K(),lb.classList.remove("active"),mb.classList.remove("active"),pb=b.changedTouches[0].pageX,endY0=b.changedTouches[0].pageY,pb+5>=ob&&ob>=pb-5&&endY0+5>=startY0&&startY0>=endY0-5?y():(ob>pb?M()?O():(K(),H(0)):N()?P():(K(),H(0)),setTimeout(A,500,!0))))}function m(){console.log("touch cancel")}function n(){a[Mb].style["-webkit-transform-origin"]="",a[Mb].style["-moz-transform-origin"]="",a[Mb].style["-ms-transform-origin"]="",a[Mb].style["transform-origin"]="",a[Mb].style["-webkit-transform"]="translateX(0px) translateY(0px) scale(1)",a[Mb].style["-moz-transform"]="translateX(0px) translateY(0px) scale(1)",a[Mb].style["-ms-transform"]="translateX(0px) translateY(0px) scale(1)",a[Mb].style.transform="translateX(0px) translateY(0px) scale(1)",Wb=1,_b=0,ac=0,Xb=0,Yb=0,Ub=bc,Tb=cc,Zb=0,$b=0}function o(a){console.log("arrow touch start"),a.preventDefault(),a.target.classList.add("active")}function p(a){console.log("arrow touch end"),a.preventDefault(),a.target.classList.contains("right-arrow-icon")?E():F(),a.target.classList.remove("active")}function q(a){a.preventDefault(),ob=a.clientX,startY0=a.clientY,U.addEventListener("mousemove",r,!1),U.classList.add("moving"),L()}function r(a){if(console.log("mouse move"),a.preventDefault(),Sb){console.log("panning"),pb=a.clientX,endY0=a.clientY,bc=Xb-(ob-pb),cc=Yb-(startY0-endY0);var b=bb,c=cb;b>=bc+Ib+(b-Ib)*Wb?(bc=0,Ib=b):bc+Ib*(1-Wb)>=0&&(bc=0,Ib=0),c>=cc+Jb+(c-Jb)*Wb?(cc=0,Jb=c):cc+Jb*(1-Wb)>=0&&(cc=0,Jb=0),G(Ib,Jb,bc,cc,Wb)}else{var d=parseFloat(a.clientX)-parseFloat(ob);H(d)}}function s(a){console.log("mouse end"),a.preventDefault(),U.removeEventListener("mousemove",r,!1),U.classList.remove("moving"),K(),Sb?(Xb=bc,Yb=cc,(ob==pb||null==pb)&&y()):(pb=a.clientX,ob==pb?y():(ob>pb?M()?O():(K(),H(0)):N()?P():(K(),H(0)),setTimeout(A,500,!0)))}function t(b){Kb="DOMMouseScroll"==b.type?-120*b.detail:b.wheelDelta,console.log("delta = "+Kb),Kb>0&&(B(),Sb=!0);var c=Wb+Kb/1e3,d=20;1>c?(c=1,A(),Sb=!1):c>d&&(c=d);var e=b.clientX-Zb,f=b.clientY-$b,g=_b*Wb,h=ac*Wb;if(Ib=e/Wb,Jb=f/Wb,(Math.abs(e-g)>1||Math.abs(f-h)>1)&&d>Wb?(Xb+=(e-g)*(1-1/Wb),Yb+=(f-h)*(1-1/Wb)):(1!=Wb||e!=g&&f!=h)&&(Ib=g/Wb,Jb=h/Wb),0>=Kb){var i=bb,j=cb;i>=Xb+Ib+(i-Ib)*c?(Xb=0,Ib=i):Xb+Ib*(1-c)>=0&&(Xb=0,Ib=0),j>=Yb+Jb+(j-Jb)*c?(Yb=0,Jb=j):Yb+Jb*(1-c)>=0&&(Yb=0,Jb=0)}G(Ib,Jb,Xb,Yb,c),Zb=a[Mb].getBoundingClientRect().left,$b=a[Mb].getBoundingClientRect().top,Vb=c,Wb=c,_b=Ib,ac=Jb,Ub=Xb,Tb=Yb}function u(a){console.log("mouse over"),a.preventDefault(),a.target.classList.add("active")}function v(a){console.log("mouse out"),a.preventDefault(),a.target.classList.remove("active")}function w(a){a.preventDefault(),lb.classList.remove("active"),mb.classList.remove("active")}function x(a){a.preventDefault();var b=a.keyCode?a.keyCode:a.which;39==b||40==b?(lb.classList.add("active"),M()&&O()):(37==b||38==b)&&(mb.classList.add("active"),N()&&P())}function y(){console.log("toggle icons"),T.classList.contains("icons-visible")?(ab=!0,B()):(z(),ab=!1)}function z(){T.classList.add("icons-visible"),T.classList.add("not-zoomed"),T.classList.remove("zoomed")}function A(a){Sb||(a="undefined"!=typeof a?a:!1,a?(db&&clearTimeout(db),db=setTimeout(A,1400)):ab||z(),C())}function B(){T.classList.remove("icons-visible")}function C(){0==Mb?(T.classList.contains("fade-left-arrow")||T.classList.add("fade-left-arrow"),T.classList.remove("fade-right-arrow")):Mb==V.length-1?(T.classList.contains("fade-right-arrow")||T.classList.add("fade-right-arrow"),T.classList.remove("fade-left-arrow")):(T.classList.remove("fade-left-arrow"),T.classList.remove("fade-right-arrow"))}function D(){window.location.href=b}function E(){Pb||M()&&O()}function F(){Pb||N()&&P()}function G(b,c,d,e,f){a[Mb].style["-webkit-transform-origin"]=b+"px "+c+"px",a[Mb].style["-ms-transform-origin"]=b+"px "+c+"px",a[Mb].style["transform-origin"]=b+"px "+c+"px",a[Mb].style.MozTransformOrigin=b+"px "+c+"px",a[Mb].style["-webkit-transform"]="translateX("+d+"px) translateY("+e+"px) scale("+f+")",a[Mb].style["-ms-transform"]="translateX("+d+"px) translateY("+e+"px) scale("+f+")",a[Mb].style.transform="translateX("+d+"px) translateY("+e+"px) scale("+f+")"}function H(a){Nb=a,U.style.transform="translateX("+a+"px)",U.style["-webkit-transform"]="translateX("+a+"px)",U.style["-ms-transform"]="translateX("+a+"px)"}function I(){console.log("onResize"),bb=window.innerWidth,cb=window.innerHeight,U.style.left=-bb+"px",U.style.width=3*bb+"px",J(),window.scrollTo(0,0),n(),Q(Mb)}function J(){[].forEach.call(a,function(a){a.style.width=bb+"px"})}function K(){U.classList.add("transition")}function L(){U.classList.remove("transition")}function M(){return null!=V[Mb+1]?!0:!1}function N(){return null!=V[Mb-1]?!0:!1}function O(){Pb=!0,console.log("slide next"),K(),Mb+=1,hb?(console.log("move next early"),clearTimeout(hb),H(0),Q(Mb)):(H(-bb),hb=setTimeout(Q,500,Mb))}function P(){Pb=!0,console.log("slide previous"),K(),Mb-=1,hb?(console.log("move next early"),clearTimeout(hb),H(0),Q(Mb)):(H(bb),hb=setTimeout(Q,500,Mb))}function Q(a){hb=null,L(),Sb&&n(),Mb=a,H(0),R(K),C(),Pb=!1}function R(){for(Z=0,_="";Z<V.length;)Z>=Mb-c&&Mb+c>=Z?(a[Z].style.backgroundSize="",a[Z].style.backgroundImage="url("+Y[Z].src+")",a[Z].style.transform="translateZ(0)",a[Z].style["-webkit-transform"]="translateZ(0)",a[Z].style["-ms-transform"]="translateZ(0)",a[Z].style["-webkit-backface-visibility"]="hidden",a[Z].style.marginLeft=0,null==a[Z].parentNode&&U.children[Z].appendChild(a[Z])):null!=a[Z].parentNode&&a[Z].parentNode.removeChild(a[Z]),Z++;0==Mb&&(a[0].style.marginLeft=bb+"px")}function S(){U.addEventListener("touchstart",j,!1),U.addEventListener("touchmove",k,!1),U.addEventListener("touchend",l,!1),U.addEventListener("touchcancel",m,!1),lb.addEventListener("touchstart",o,!1),mb.addEventListener("touchstart",o,!1),lb.addEventListener("touchend",p,!1),mb.addEventListener("touchend",p,!1),U.addEventListener("mousedown",q,!1),U.addEventListener("mouseup",s,!1);var a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";U.addEventListener(a,t,!1),lb.addEventListener("mouseover",u,!1),lb.addEventListener("mouseout",v,!1),mb.addEventListener("mouseover",u,!1),mb.addEventListener("mouseout",v,!1),window.addEventListener("keyup",w,!1),window.addEventListener("keydown",x,!1),nb.addEventListener("click",D,!1),lb.addEventListener("click",E,!1),mb.addEventListener("click",F,!1),window.addEventListener("resize",I,!1)}var T,U,V,W,X,Y,Z,$,_,ab,bb,cb,a,db,eb,fb,gb,c,b,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb=!1,Mb=0,Nb=0,Ob=0,Pb=!1,Qb=!1,Rb=!1,Sb=!1,Tb=0,Ub=0,Vb=1,Wb=1,Xb=0,Yb=0,Zb=0,$b=0,_b=0,ac=0,bc=0,cc=0;"complete"==document.readyState?d():document.addEventListener("DOMContentLoaded",function(){d()},!1)}